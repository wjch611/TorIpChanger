# Tor IP更换工具

## 介绍

这是一个用于通过Tor网络更换IP地址的Python工具。通过此工具，您可以更换Tor的出口节点IP，并验证您的Tor代理是否正常工作。工具使用了Tor的控制端口与`stem`库来发送控制信号，并自动重试连接，确保稳定性。

## 特性

- **自动获取当前IP**：使用多个IP检测服务（如`checkip.amazonaws.com`、`icanhazip.com`等）来获取您的当前IP地址。
- **Tor IP更换**：通过向Tor控制端口发送`NEWNYM`信号，切换出口IP。
- **错误重试机制**：自动处理网络请求和Tor控制连接中的错误，并支持重试机制。
- **随机更换间隔**：用户可以设置更换IP的时间间隔，支持固定或随机时间间隔。
- **多次更换**：支持设定IP更换的次数，或设置为无限循环。

## 配置

以下是工具运行时需要设置的配置项：

- **TOR_CONTROL_PORT**：Tor控制端口（默认：`9051`）
- **TOR_PASSWORD**：Tor控制端口的密码（默认：`xxx`，请使用`tor --hash-password`生成您的密码）
- **CHECK_IP_URLS**：多个IP检测服务的URL列表，用于获取当前IP地址
- **PROXY**：Tor代理配置（默认：`socks5h://127.0.0.1:9050`）
- **MAX_RETRIES**：最大重试次数（默认：`3`）
- **BASE_DELAY**：基础延迟时间（默认：`5`秒）

## 使用说明

1. **安装依赖**：

   运行此工具之前，确保已安装以下Python依赖：

   ```
   pip install requests stem
   ```

2. **启动Tor服务**：

   确保Tor服务已正确运行并监听在`9050`端口用于代理，`9051`端口用于控制。您可以通过以下命令启动Tor：

   ```
   tor
   ```

3. **运行工具**：

   在命令行中运行以下命令启动工具：

   ```
   python tor_ip_changer.py
   ```

   工具将要求您输入以下参数：

   - **更换间隔**：IP更换之间的等待时间（秒），输入`0`以使用随机间隔（10-20秒）。
   - **更换次数**：IP更换的次数，输入`0`表示无限循环。

   例如：

   ```
   bash复制编辑输入更换间隔(秒，0=随机10-20秒): 15
   输入更换次数(0=无限循环): 5
   ```

4. **工具输出**：

   工具将在每次成功更换IP后显示当前的外部IP。每次更换IP后会显示如下内容：

   ```
   bash复制编辑[1] 正在更换IP...
   当前IP: 123.45.67.89
   ```

   如果无法更换IP，将显示错误信息。

## 常见问题

1. **无法连接到Tor网络**：
   - 确保Tor服务正在运行，并且`9050`端口可用。
   - 检查防火墙设置，确保Tor能够通过`9050`端口进行通信。
2. **Tor控制端口认证失败**：
   - 请确保您在配置中设置了正确的`TOR_PASSWORD`，并且该密码是通过`tor --hash-password`命令生成的。
3. **IP更换失败**：
   - 如果多次尝试失败，请检查您的Tor配置，确保控制端口正常工作。

## 代码结构

- **`tor_ip_changer.py`**：主工具脚本。
- **`change_ip()`**：负责向Tor控制端口发送`NEWNYM`信号以更换IP。
- **`get_ip()`**：获取当前的外部IP地址。
- **`verify_tor_connection()`**：验证Tor代理是否正常工作。
- **`main()`**：工具的入口，处理用户输入和执行任务。

## 贡献

欢迎提交issues和pull requests。如果您有任何建议或改进，欢迎随时参与讨论。

## 许可证

此工具使用MIT许可证，详细信息请参见LICENSE文件。

------

如果你有任何问题或建议，欢迎提交issue或直接联系我。